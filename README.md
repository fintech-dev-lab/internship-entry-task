# Тестовое задание: REST API для игры "Крестики-нолики"

Это решение тестового задания на позицию стажера backend-разработчика. Проект представляет собой RESTful API для игры в крестики-нолики NxN, реализованный на .NET 9 с использованием PostgreSQL в качестве хранилища данных.

## Ключевые особенности

*   **Чистая архитектура (Clean Architecture)** для разделения логики и гибкости системы.
*   **Паттерн CQRS** с использованием библиотеки MediatR для разделения команд и запросов.
*   **Контейнеризация с Docker и Docker Compose** для простого развертывания и запуска всего стека одной командой.
*   **Unit-тесты** (xUnit) для проверки ключевой бизнес-логики.
*   **Идемпотентность** для `POST` запросов на совершение хода.
*   **Персистентность данных** после перезапуска контейнеров.
*   **Конфигурация через переменные окружения** (размер поля, условия победы, строка подключения).

---

## Архитектура проекта

Проект построен на принципах **Чистой архитектуры** и состоит из четырех основных слоев (проектов):

1.  **`TicTacToe.Domain`**
    *   **Ядро приложения.** Содержит бизнес-сущности (`Game`), перечисления и самую важную бизнес-логику, которая не зависит от технологий. Не имеет зависимостей от других слоев.

2.  **`TicTacToe.Application`**
    *   **Слой логики приложения.** Определяет сценарии использования (use cases) с помощью команд и запросов (CQRS). Содержит интерфейсы-абстракции (`IGameRepository`, `IIdempotencyCache`) для внешних зависимостей, реализуя Принцип инверсии зависимостей. Зависит только от `Domain`.

3.  **`TicTacToe.Infrastructure`**
    *   **Слой инфраструктуры.** Содержит реализацию интерфейсов из слоя Application. Здесь находится код для работы с внешним миром: взаимодействие с базой данных PostgreSQL через Entity Framework Core, реализация кэша и т.д. Зависит от `Application`.

4.  **`TicTacToe.Api`**
    *   **Слой представления.** Точка входа в приложение. Представляет собой ASP.NET Core Web API с контроллерами, которые принимают HTTP-запросы, отправляют команды/запросы в MediatR и возвращают ответы. Зависит от `Application` и `Infrastructure`.

**Поток зависимостей:** `Api` -> `Infrastructure` -> `Application` -> `Domain`.

---

## Как запустить проект

Для запуска проекта убедитесь, что у вас установлен и запущен **Docker Desktop**.

1.  Склонируйте репозиторий на ваш компьютер.
2.  Откройте терминал в корневой папке проекта (где находится файл `docker-compose.yml`).
3.  Выполните следующую команду:

    ```bash
    docker-compose up --build
    ```
Эта команда автоматически соберет образ .NET-приложения, запустит контейнеры с API и базой данных PostgreSQL, применит миграции к БД и свяжет их вместе.

После успешного запуска API будет доступно по адресу `http://localhost:8080`.

---

## Описание API

Интерактивная документация Swagger доступна по адресу `http://localhost:8080/swagger/index.html` после запуска приложения.

### Основные эндпоинты

#### 1. Создание новой игры
*   **Endpoint:** `POST /games`
*   **Описание:** Создает новую игру с параметрами (размер поля, условие победы), взятыми из конфигурации на сервере.
*   **Тело запроса:** пустое.
*   **Успешный ответ:** `201 Created`
    ```json
    {
      "gameId": "d290f1ee-6c54-4b01-90e6-d701748f0851",
      "board": [
        [ null, null, null ],
        [ null, null, null ],
        [ null, null, null ]
      ],
      "status": "InProgress",
      "nextPlayer": "X"
    }
    ```

#### 2. Получение состояния игры
*   **Endpoint:** `GET /games/{id}`
*   **Описание:** Возвращает текущее состояние игры по ее идентификатору.
*   **Успешный ответ:** `200 OK`
    *   Тело ответа аналогично `POST /games`.
*   **Ошибки:** `404 Not Found`

#### 3. Совершение хода
*   **Endpoint:** `POST /games/{id}/moves`
*   **Описание:** Выполняет ход игрока. Запрос должен быть идемпотентным.
*   **Заголовки:**
    *   `Idempotency-Key` (обязательный): Уникальный ключ для каждого запроса на ход (например, `GUID`).
*   **Тело запроса:**
    ```json
    {
      "player": "X",
      "row": 0,
      "column": 1
    }
    ```
*   **Успешный ответ:** `200 OK`
    *   Тело ответа содержит обновленное состояние игры.
*   **Ошибки:**
    *   `400 Bad Request`: Некорректный JSON, отсутствует заголовок `Idempotency-Key`, ход вне поля, клетка занята.
    *   `404 Not Found`: Игра не найдена.

#### 4. Проверка работоспособности
*   **Endpoint:** `GET /health`
*   **Описание:** Простой эндпоинт для проверки доступности сервиса.
*   **Успешный ответ:** `200 OK` (с пустым телом).

---